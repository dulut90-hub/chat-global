<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat Global AI</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f0f2f5; padding:20px; }
    #chat-container { width:400px; margin:0 auto; background:white; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); padding:20px; display:none; }
    #chat-box { border:1px solid #ccc; height:300px; overflow-y:auto; padding:10px; background:#f9f9f9; margin-bottom:10px; border-radius:4px; }
    #chat-input { width:70%; padding:8px; border-radius:4px; border:1px solid #ccc; }
    #send-btn { padding:8px 12px; border:none; border-radius:4px; background:#007bff; color:white; cursor:pointer; }
    #send-btn:hover { background:#0056b3; }
    #login-btn { padding:10px 20px; border:none; border-radius:4px; background:#34a853; color:white; cursor:pointer; }
    #login-btn:hover { background:#0f8a41; }
  </style>
</head>
<body>
  <div id="login-container" style="text-align:center;">
    <h3>Login untuk Chat Global AI</h3>
    <button id="login-btn">Login dengan Google</button>
  </div>

  <div id="chat-container">
    <h3>Chat AI Global</h3>
    <div id="chat-box"></div>
    <input id="chat-input" type="text" placeholder="Ketik perintah AI...">
    <button id="send-btn">Kirim</button>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-analytics.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAhKMFMm1zKbeWBnjsAyKe0ybOc43ZiybY",
      authDomain: "chat-global-74cdf.firebaseapp.com",
      projectId: "chat-global-74cdf",
      storageBucket: "chat-global-74cdf.appspot.com",
      messagingSenderId: "980925830481",
      appId: "1:980925830481:web:a19be163cff16dacc42f70",
      measurementId: "G-8MEB5XMGKV"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    const tasksCol = collection(db, "tasks");

    const chatBox = document.getElementById("chat-box");
    const chatInput = document.getElementById("chat-input");
    const sendBtn = document.getElementById("send-btn");
    const loginBtn = document.getElementById("login-btn");
    const chatContainer = document.getElementById("chat-container");
    const loginContainer = document.getElementById("login-container");

    // Google Login
    loginBtn.addEventListener("click", async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (err) {
        console.error("Login error:", err);
      }
    });

    // Cek login state
    onAuthStateChanged(auth, (user) => {
      if (user) {
        loginContainer.style.display = "none";
        chatContainer.style.display = "block";
      } else {
        loginContainer.style.display = "block";
        chatContainer.style.display = "none";
      }
    });

    // Kirim instruksi ke Firestore
    async function sendTask(text) {
      if(!text) return;
      const user = auth.currentUser;
      await addDoc(tasksCol, {
        text: text,
        timestamp: Date.now(),
        status: "pending",
        user: user ? user.displayName : "Guest",
        email: user ? user.email : ""
      });
    }

    sendBtn.addEventListener("click", () => {
      sendTask(chatInput.value);
      chatInput.value = "";
    });

    chatInput.addEventListener("keypress", (e) => {
      if(e.key === "Enter") {
        sendBtn.click();
      }
    });

    // Listen tasks dari Firestore
    const q = query(tasksCol, orderBy("timestamp"));
    onSnapshot(q, (snapshot) => {
      chatBox.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const msg = document.createElement("div");
        msg.textContent = `[${data.status}] ${data.user}: ${data.text}`;
        chatBox.appendChild(msg);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    });
  </script>
</body>
</html>
